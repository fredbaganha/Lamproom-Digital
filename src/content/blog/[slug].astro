---
import Layout from "../../components/Layout.astro";
import { getCollection } from "astro:content";

const posts = await getCollection("blog");

// Sort posts by date (newest first)
posts.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const { slug } = Astro.params;
const index = posts.findIndex((p) => p.slug === slug);
const post = posts[index];

if (!post) {
  throw new Error(`Post not found: ${slug}`);
}

// Determine next/previous
const prevPost = posts[index + 1]; // older
const nextPost = posts[index - 1]; // newer
---

<Layout title={post.data.title}>
  <h1>{post.data.title}</h1>
  <p><em>{post.data.date.toDateString()}</em></p>
  
  <article>
    <post.Content />
  </article>

  <nav class="post-nav">
    {prevPost ? (
      <a class="post-btn prev" href={`/blog/${prevPost.slug}/`}>
        ← {prevPost.data.title}
      </a>
    ) : <span></span>}
    
    {nextPost ? (
      <a class="post-btn next" href={`/blog/${nextPost.slug}/`}>
        {nextPost.data.title} →
      </a>
    ) : <span></span>}
  </nav>
</Layout>

<style>
  .post-nav {
    margin-top: 3rem;
    display: flex;
    justify-content: space-between;
    gap: 1rem;
  }

  .post-btn {
    flex: 1;
    padding: 1rem 1.5rem;
    background: #f3f4f6;
    color: #111;
    text-decoration: none;
    border-radius: 0.75rem;
    font-weight: 500;
    transition: background 0.2s ease;
    text-align: center;
  }

  .post-btn:hover {
    background: #e5e7eb;
  }

  .prev {
    text-align: left;
  }

  .next {
    text-align: right;
  }
</style>
